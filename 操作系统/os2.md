> 计算机操作系统
>
> 教材《计算机操作系统（第四版）》 汤小丹等
>
> PPT 四川大学 杜中军老师
>
> Find more on github.com/textGuan/Review

# 第二章 进程的描述与控制

熟悉进程引入的必要性；熟练掌握进程的定义和特征，熟练掌握进程的三个基本状态和状态的转换，熟练掌握进程存在的唯一标志--进程控制块，熟悉进程上下文。熟悉内核的功能，掌握增加“挂起”、 “激活”操作的五个状态图和状态的转换，熟悉创建、撤消、阻塞、唤醒、挂起和激活进程控制原语的功能，一般了解线程的概念。

## 2.1 进程的引入

### 2.1.1 程序顺序执行与特征

程序在执行时，各程序段必须按照先后次序逐个执行。其先后执行次序关系可用前驱图表示。

```
前驱图：一个有向无循环图，结点表示各程序段操作，结点间的有向边表示两程序段的操作之前存在的前驱关系（“->表示”）
```

程序顺序执行特征：

顺序性：程序各程序段严格按照规定的顺序执行

封闭性：程序运行时独占全部资源

可再现性：执行环境和初始条件相同，程序多次执行可获得相同结果

### 2.1.2 程序并发执行特征

间断性：并发程序之间相互制约，形成“执行-暂停-执行”的间断性活动规律

失去封闭性：多个程序共享系统中的各种资源

不可再现性：由于失去封闭性故不具有再现性

程序与程序的执行不再一一对应

### 2.1.3 进程的引入

可并发执行的程序在一个数据集合上的运行过程

进程的特征（与程序的区别）：

​	动态性：进程有一定的生命周期。创建-产生，调度-执行，得不到资源-暂停，撤销-死亡；程序是静态的-存放在	介质上一组有序指令的集合

​	并发性：多个进程实体同存于内存中，能在一段时间内同时运行。程序不能并发执行

​	独立性：进程时一个独立获得资源、独立调度，能独立运行的基本单位

​	异步性：进程按异步方式进行

​	结构特征：进程实体由程序段、数据段和进程控制块三部分组成

​	生命特征：进程有一个生命周期，程序作为一种软件资源长期保存

​	通过多次执行，一个程序可对应多个进程；通过调用关系，一个进程可包括多个程序

### 2.1.4 进程的描述

进程的三个基本状态：

运行态：进程在处理机上运行

就绪态：一个进程获得了除处理机外的一切所需资源，一旦得到处理机即可运行

阻塞态：一个进程等待某一事件发生而暂时停止运行



就绪态->运行态：处理机空闲，进程调度程序将处理机分配给一个处于就绪态的进程

运行态->就绪态：分配给它的时间片已用完，不得不让出（被抢占）处理机；系统采用抢占式调度算法时，有高优先级进程进入就绪状态

阻塞态->就绪态：阻塞态等待的事件已发生

运行态->阻塞态：运行中的进程等待某一事件发生才能继续运行

 

不考虑系统开销，若只有一个处理机，任意时刻最多只有一个进程处于运行态，最多n-1个进程处于就绪态，最多n个进程处于阻塞态

若一个进程由运行态转为阻塞态，另一个就绪态进程（如果有）必转为运行状态

 

## 2.2 进程控制模块（Process Control Block，PCB）

进程存在的唯一标志：OS对进程的控制根据PCB来进行，对进程管理也通过对PCB管理实现。

### 2.2.1 PCB信息：

进程标识符：唯一地标识一个进程 

```
外部标识符：字母组成，供用户使用
内部标识符：整数组成，方便系统管理
```

进程调度信息：包括进程状态（运行、阻塞、就绪）、队列（阻塞队列、就绪队列）、队列指针、调度参数、进程优先级、进程已执行时间、进程已等待时间等

处理机状态信息：处理机各种寄存器的内容，使进程被中断后重新执行时能恢复现场从断点处继续运行

进程控制信息：程序和数据的地址、I/O资源清单、保证进程正常运行的同步和通信机制等

家族信息：进程的父子进程标识符、进程的用户主等

### 2.2.2 PCB组织方式

链接方式：不同属性PCB之间链接

索引方式

## 2.3 进程上下文

进程上下文实际上是执行活动全过程的静态描述，包括：

系统中与执行该进程有关的各种寄存器（通用寄存器、程序计数器PC、程序状态寄存器PS等）的值

程序段在经编译之后形成的机器指令代码集（正文段）、数据集及各种堆栈值和PCB结构

## 2.4 进程控制

### 2.4.1 内核

80386及更高级的CPU可以提供程序代码4层不同等级的权力，包括有Ring0-Ring3，Ring0是最高等级优先级，访问所有系统内存和所有CPU指令。操作系统在核心态（Ring0）下运行，有最高的特权，用户应用程序在用户态（Ring3）下运行    

```
核心态又称系统态、特态、管态
用户态又称常态、目态、算态
```

原语：一种特殊的广义指令，由系统通过一段不可分割的指令操作来完成，又称原子操作，在核心态下完成。进程控制操作（创建、撤销、阻塞……）大多为原语操作

内核功能：内核在核心态下运行，常驻内存，通过执行各种原语操作来实现各种控制和管理功能

### 2.4.2 进程状态的细化

挂起：暂停某个进程以便排除系统故障或暂时减轻系统负荷

激活：恢复被挂起的进程



五个进程状态之间的转化：

```
运行态-执行挂起操作-静止就绪
活动就绪-执行挂起操作-静止就绪
活动阻塞-执行挂起操作-静止阻塞
静止就绪-执行激活操作-活动就绪
静止阻塞-执行激活操作-活动就绪
静止阻塞-等待事件发生-静止就绪
```



### 2.4.3 进程控制原语

创建进程：

```
系统建立时创建
使用进程创建原语创建
```

 

创建原语：为新进程创建一个PCB，将调用进程提供的参数填入PCB中，并设置新进程状态，将PCB插入到队列中

 

进程创建时机：

```
分时系统中用户登陆成功后，系统为该用户创建一个进程用于接受用户的命令
在批处理系统中发生作业调度时为选中的作业创建进程
当应用进程在执行过程中提出某种特殊服务，系统创建专用进程来提供这种服务
用户进程自己调用进程创建原语来创建子进程
```

 

撤销原语/终止

对于树型层次结构的进程，系统撤销原语采用的策略是：父进程死亡，子进程均死亡，资源全部释放回收，并将他们从所有的队列中移除，释放PCB；若撤销的进程正在执行，则调用进程调度程序将处理器分给其他进程

 

进程撤销的时机：

```
正常结束
异常结束：越界错、保护错、非法指令、特权指令错、除法错等
外界干预：程序员干预停止、父进程终止子进程或父进程终止
```

 

阻塞原语：当前进程因请求某时间而不能执行时，该进程调用阻塞原语阻塞自己，暂时放弃处理机——进程自身的主动行为

 

阻塞的时机：

```
所需资源得不到满足时
I/O请求
等待数据（进程同步）
某些系统进程在无事可做时阻塞自己（输入/输出进程）
```

 

唤醒原语：阻塞的进程所期待的事件发生时，有关进程和过程调用wakeup原语，将阻塞的进程唤醒，将等待该事件的进程从阻塞队列移出，插入到就绪队列

 

唤醒时机：

```
所需资源可以得到（进程互斥）
I/O完成
数据准备好（进程同步）
某些系统进程有事可做时（输入/输出进程）
```

 

挂起原语：只能挂起他自己或其子孙

 

挂起时机：

```
终端用户需要
父进程需要
内存紧张
OS需要（检查统计、记账等）
可能影响到实时任务的性能时
```

 

激活原语：用户进程或父进程通过调用激活原语将被挂机的进程激活

 

激活的时机：

```
与挂起相反
```

 

## 2.5 线程

进程既是一个拥有资源的独立单位（可独立分配虚地址空间、主存和其他），又是一个可独立调度和分派的基本单位

资源拥有单元称为进程（或任务），资源调度单位称为线程 

线程只拥有一点在运行中必不可省的资源，但他可与同属一个进程的其他线程共享进程所拥有的全部资源。线程定义为进程内一个执行单元或一个可调度实体。

 

## 2.6 典型例题

```
正在执行的进程由于其时间片完而被暂停执行，此时进程应从运行态变为﹎﹎A﹎﹎状态；处于静止阻塞状态的进程，在进程等待的事件出现后，应转变为﹎﹎B﹎﹎状态；若进程正处于运行态时，应终端的请求而暂停下来以便研究其运行情况(执行挂起进程原语)，这时进程应转变为﹎﹎C﹎﹎状态，若进程已处于阻塞状态，则此时应转变为﹎﹎D﹎﹎状态，若进程已处于就绪状态，则此时应转变为﹎﹎E﹎﹎状态；执行解除挂起进程原语后，如挂起进程处于就绪状态，则应转变为﹎﹎F﹎﹎态，如处于阻塞状态，则应转变为﹎﹎G﹎﹎态；一个进程刚被创建时，它的初始状态为﹎﹎H﹎﹎。
```

```
参考 2.4.2 进程状态的细化
```
